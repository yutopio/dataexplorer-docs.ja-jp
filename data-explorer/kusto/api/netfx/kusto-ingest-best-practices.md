---
title: Kusto インジェストクライアントライブラリ-ベストプラクティス-Azure データエクスプローラー
description: この記事では、Kusto インジェストクライアントライブラリのベストプラクティスについて説明します。
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 08/16/2019
ms.openlocfilehash: 615bb1ef9400f3671b88e2108d4e6cad0469978b
ms.sourcegitcommit: bb8c61dea193fbbf9ffe37dd200fa36e428aff8c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/13/2020
ms.locfileid: "83373684"
---
# <a name="kusto-ingest-client-library---best-practices"></a>Kusto インジェストクライアントライブラリ-ベストプラクティス

## <a name="select-the-right-ingestclient-flavor"></a>適切 IngestClient フレーバーを選択します

[KustoQueuedIngestClient](kusto-ingest-client-reference.md#interface-ikustoqueuedingestclient)を使用することをお勧めします。これは、ネイティブデータインジェストモードとして推奨されます。 その理由を説明します。
* デプロイ中など、エンジンのダウンタイム時に直接インジェストを行うことはできません。 キューに置かれたインジェストモードでは、要求は Azure キューに保存され、必要に応じてデータ管理サービスが再試行されます。
* データ管理サービスを使用すると、エンジンはインジェスト要求での過負荷を防止できます。 たとえば、直接インジェストを使用してこのコントロールを上書きすると、エンジンの取り込みとクエリのパフォーマンスに重大な影響を与える可能性があります。
* データ管理は、複数のインジェスト要求を集計します。 この集計により、作成される最初のシャード (エクステント) のサイズが最適化されます。
* 各インジェストに関するフィードバックを簡単に取得できます。

## <a name="avoid-tracking-ingest-operation-status"></a>取り込み操作の状態の追跡を避ける

[取り込み操作の状態の追跡](kusto-ingest-client-status.md#tracking-ingestion-status-kustoqueuedingestclient)は便利です。 ただし、大量のデータストリームの場合は、すべてのインジェスト要求に対して肯定通知を有効にすることを避ける必要があります。 このような追跡により、基になる xStore リソースに極端な負荷がかかり、インジェストの待機時間が長くなり、クラスターの応答性が完全でなくなる可能性があります。

## <a name="optimizing-for-throughput"></a>スループットの最適化

インジェストは、大きなまとまりで実行した場合に最適です。 
* 最小限のリソースを消費する
* これにより、最大で COGS に最適化されたデータシャードが生成され、データトランザクションが最適になります。

Kusto インジェストライブラリを使用してデータを取り込み、エンジンに直接データを送信して、データを**100 MB**から**1 GB (非圧縮)** のバッチで送信することをお勧めします。
* この上限は、取り込みプロセスで使用されるメモリの量を減らすために、エンジンを直接操作するときに重要です。 

> [!NOTE]
> クラスを使用すると `KustoQueuedIngestClient` 、大量のデータブロックがより小さなチャンクに分割され、これらの小さなチャンクは、エンジンに到達する前に一定のレベルに集計されます。

* 取り込まれたデータサイズの下限は重要ですが、重要度は低くなります。 複数の小さなバッチでのデータの取り込みは、大きなバッチを使用する場合よりも若干効率が悪くなりますが、まったく問題ありません。 また、クラスは、 `KustoQueuedIngestClient` 大量のデータを取り込み、それを大量のチャンクにバッチ処理してからエンジンに送信することができない場合にも問題を解決します。

## <a name="other-factors-that-impact-ingestion-throughput"></a>インジェストスループットに影響するその他の要因

複数の要因がインジェストのスループットに影響を与える可能性があります。 インジェストパイプラインを計画するときは、次の点を必ず評価してください。これは、COGs に大きな影響を与える可能性があります。

| 考慮すべき要素 |  説明                                                                                              |
|--------------------------|-----------------------------------------------------------------------------------------------------------|
| データ形式              | CSV は、最も高速な取り込み形式です。 JSON は、通常、同じデータ量に対して 2 ~ 3 倍の時間がかかります。|
| テーブルの幅              | 実際に必要なデータのみを取り込むようにしてください。 テーブルが広くなるほど、より多くの列をエンコードしてインデックスを作成する必要があり、スループットが低下します。 インジェストマッピングを指定することで、取り込まれたを取得するフィールドを制御できます。       |
| ソースデータの場所     | インジェストを高速化するために、リージョンをまたがる読み取りは避けてください。                                                       |
| クラスターに負荷をかける      | クラスターのクエリ負荷が高い場合、ingestions の完了に時間がかかり、スループットが低下します。|

## <a name="optimizing-for-cogs"></a>COGS の最適化

Kusto クライアントライブラリを使用して Azure データエクスプローラーにデータを取り込むことは、低コストで最も信頼性の高いオプションです。 お客様にインジェスト方法をレビューし、blob トランザクションのコスト効率を大幅に向上させる Azure Storage 価格を活用することをお勧めします。

* **取り込まれたデータチャンクの数を制限**します。
    Azure データエクスプローラーインジェストのコストをより適切に制御し、毎月の請求額を減らすには、取り込まれたのデータチャンク (ファイル/blob/streams) の数を制限します。
* **大量のデータチャンク (圧縮**されていないデータを 1 gb まで) を取り込みます。 
    多くのチームは、膨大な量の少量のデータチャンクを取り込みすることで、低待機時間を実現しようとしています。これは、効率が悪く、コストが高くなります。 
* **バッチ**処理。 クライアント側でバッチ処理を行うと、最適化が向上します。 
* 厳密で圧縮されていない**データサイズを使用して Kusto. インジェストクライアントを提供**します。
    そうしないと、余分なストレージトランザクションが発生する可能性があります。
* フラグをに設定して、取り込み用のデータを送信し**ないよう**に `FlushImmediately` `true` します。 また、タグが設定された小さなチャンクを送信することは避けて `ingest-by` / `drop-by` ください。 これらのメソッドを使用すると、次のようになります。
     * インジェスト中にサービスがデータを正しく集計できないようにする
     * インジェスト後に不要なストレージトランザクションを発生させる
     * COGS に影響を与える
     * 過剰に使用されている場合は、クラスターのインジェストまたはクエリパフォーマンスが低下する可能性があります
